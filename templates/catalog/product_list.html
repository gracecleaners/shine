{% extends 'base.html' %}
{% load static catalog_tags %}

{% block title %}Shop All Products - Angaza Creatives{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'catalog:home' %}">Home</a></li>
                        <li class="breadcrumb-item active">Shop</li>
                    </ol>
                </nav>
                <h1 class="page-title">All Products</h1>
            </div>
            <div class="col-lg-6 text-lg-end">
                <p class="results-count">{{ products.paginator.count }} products found</p>
            </div>
        </div>
    </div>
</section>

<!-- Products Section -->
<section class="shop-section">
    <div class="container">
        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3">
                <div class="filters-sidebar" id="filtersSidebar">
                    <div class="filters-header">
                        <h4>Filters</h4>
                        <button class="btn btn-sm btn-link" onclick="clearFilters()">Clear All</button>
                    </div>
                    
                    <!-- Categories Filter -->
                    <div class="filter-group">
                        <h5 class="filter-title">Categories</h5>
                        <div class="filter-options">
                            {% for category in categories %}
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="{{ category.slug }}"
                                       {% if current_category == category.slug %}checked{% endif %}>
                                <span>{{ category.name }}</span>
                                <span class="count">({{ category.products.count }})</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Price Filter -->
                    <div class="filter-group">
                        <h5 class="filter-title">Price Range</h5>
                        <div class="price-range">
                            <input type="number" placeholder="Min" id="minPrice" class="form-control">
                            <span>to</span>
                            <input type="number" placeholder="Max" id="maxPrice" class="form-control">
                        </div>
                    </div>
                    
                    <!-- Cover Type Filter -->
                    <div class="filter-group">
                        <h5 class="filter-title">Cover Type</h5>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="cover_type" value="hardcover">
                                <span>Hardcover</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="cover_type" value="softcover">
                                <span>Softcover</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="cover_type" value="spiral">
                                <span>Spiral Bound</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="cover_type" value="leather">
                                <span>Leather Bound</span>
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary w-100 apply-filters-btn">Apply Filters</button>
                </div>
            </div>
            
            <!-- Products Grid -->
            <div class="col-lg-9">
                <!-- Toolbar -->
                <div class="shop-toolbar">
                    <div class="d-flex align-items-center gap-3">
                        <button class="btn btn-icon d-lg-none" id="filtersToggle">
                            <i class="fas fa-filter"></i>
                        </button>
                        <div class="view-options">
                            <button class="view-btn active" data-view="grid">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                    <div class="sort-options">
                        <label>Sort by:</label>
                        <select class="form-select" id="sortSelect">
                            <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest</option>
                            <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                            <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name: A-Z</option>
                        </select>
                    </div>
                </div>
                
                <!-- Products Grid -->
                <div class="products-grid" id="productsGrid">
                    {% for product in products %}
                    <div class="product-grid-item" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}0">
                        {% include 'catalog/includes/product_card.html' with product=product %}
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No products found</h3>
                            <p>Try adjusting your filters or browse our categories.</p>
                            <a href="{% url 'catalog:product_list' %}" class="btn btn-primary">View All Products</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if products.has_other_pages %}
                <nav class="pagination-wrapper" aria-label="Page navigation">
                    <ul class="pagination">
                        {% if products.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        {% endif %}
                        
                        {% for num in products.paginator.page_range %}
                            {% if products.number == num %}
                            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                            {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">{{ num }}</a>
                            </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('sortSelect').addEventListener('change', function() {
    const url = new URL(window.location);
    url.searchParams.set('sort', this.value);
    window.location = url;
});

function clearFilters() {
    window.location = '{% url "catalog:product_list" %}';
}
</script>
{% endblock %}
