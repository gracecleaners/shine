{% load static catalog_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% block title %}Angaza Creatives{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Premium handcrafted books, diaries, journals, notebooks, and sticky notes.{% endblock %}">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#F5A623">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Angaza Creatives">
    <link rel="apple-touch-icon" href="{% static 'images/logo.jpeg' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNavbar">
        <div class="container">
            <a class="navbar-brand" href="{% url 'catalog:home' %}">
                <img src="{% static 'images/logo.jpeg' %}" alt="Angaza Creatives" class="brand-logo">
                <span class="brand-text">Angaza</span>
            </a>
            
            <!-- Mobile Quick Actions - Always Visible -->
            <div class="mobile-quick-actions d-lg-none d-flex align-items-center">
                <!-- Search -->
                <button class="btn btn-icon mobile-search-btn" id="mobileSearchToggle">
                    <i class="fas fa-search"></i>
                </button>
                
                <!-- Cart -->
                <a href="{% url 'catalog:cart' %}" class="btn btn-icon position-relative mobile-cart-link" title="Cart">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="badge-count cart-count" id="mobileCartBadge">{{ cart_count }}</span>
                </a>
                
                <!-- Currency -->
                <button class="btn btn-icon mobile-currency-toggle" type="button" data-bs-toggle="modal" data-bs-target="#currencyModal">
                    <span class="currency-code">{% if current_currency %}{{ current_currency.code }}{% else %}USD{% endif %}</span>
                </button>
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Mobile Menu Close Button -->
                <button class="mobile-menu-close d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <i class="fas fa-times"></i>
                </button>
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'catalog:home' %}">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            Shop
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'catalog:product_list' %}">All Products</a></li>
                            <li><hr class="dropdown-divider"></li>
                            {% for category in categories %}
                            <li><a class="dropdown-item" href="{% url 'catalog:category_detail' category.slug %}">{{ category.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'catalog:about' %}">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'catalog:contact' %}">Contact</a>
                    </li>
                </ul>
                
                <!-- Desktop Navbar Actions - Hidden on Mobile -->
                <div class="navbar-actions d-none d-lg-flex align-items-center">
                    <!-- Search -->
                    <button class="btn btn-icon" id="searchToggle">
                        <i class="fas fa-search"></i>
                    </button>
                    
                    <!-- Wishlist -->
                    <a href="{% url 'catalog:wishlist' %}" class="btn btn-icon position-relative" title="Wishlist">
                        <i class="far fa-heart"></i>
                        <span class="badge-count wishlist-count" id="wishlistCount">{{ wishlist_count }}</span>
                    </a>
                    
                    <!-- Cart -->
                    <a href="{% url 'catalog:cart' %}" class="btn btn-icon position-relative" title="Cart">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="badge-count cart-count" id="cartCount">{{ cart_count }}</span>
                    </a>
                    
                    <!-- User Account -->
                    {% if user.is_authenticated %}
                    <div class="dropdown user-dropdown">
                        <button class="btn btn-icon dropdown-toggle" data-bs-toggle="dropdown" title="Account">
                            <i class="fas fa-user"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li class="dropdown-header">Hi, {{ user.first_name|default:user.username }}</li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% url 'accounts:profile' %}"><i class="fas fa-user me-2"></i> My Account</a></li>
                            <li><a class="dropdown-item" href="{% url 'accounts:order_history' %}"><i class="fas fa-shopping-bag me-2"></i> Orders</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                    {% else %}
                    <a href="{% url 'accounts:login' %}" class="btn btn-icon" title="Sign In">
                        <i class="fas fa-user"></i>
                    </a>
                    {% endif %}
                    
                    <!-- Currency Selector -->
                    <div class="dropdown currency-dropdown">
                        <button class="btn btn-currency dropdown-toggle" data-bs-toggle="dropdown">
                            {% if current_currency %}
                                {{ current_currency.code }}
                            {% else %}
                                USD
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            {% for currency in currencies %}
                            <li>
                                <a class="dropdown-item currency-option {% if currency == current_currency %}active{% endif %}" 
                                   href="#" data-currency="{{ currency.code }}">
                                    {{ currency.symbol }} {{ currency.code }} - {{ currency.name }}
                                </a>
                            </li>
                            {% empty %}
                            <li><a class="dropdown-item" href="#">$ USD - US Dollar</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <button class="search-close" id="searchClose">
            <i class="fas fa-times"></i>
        </button>
        <div class="search-container">
            <form action="{% url 'catalog:search' %}" method="GET">
                <input type="text" name="q" placeholder="Search for products..." class="search-input" autofocus>
                <button type="submit" class="search-submit">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </div>
    </div>
    
    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                        <div class="footer-brand">
                            <img src="{% static 'images/logo.jpeg' %}" alt="Angaza Creatives" class="footer-logo">
                            <span class="brand-text">Angaza Creatives</span>
                        </div>
                        <p class="footer-about">
                            Crafting beautiful stationery for your thoughts, dreams, and daily adventures. 
                            Every product is made with love and attention to detail.
                        </p>
                        <div class="footer-social">
                            <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-pinterest"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
                        <h5 class="footer-title">Shop</h5>
                        <ul class="footer-links">
                            {% for category in categories %}
                            <li><a href="{% url 'catalog:category_detail' category.slug %}">{{ category.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
                        <h5 class="footer-title">Company</h5>
                        <ul class="footer-links">
                            <li><a href="{% url 'catalog:about' %}">About Us</a></li>
                            <li><a href="{% url 'catalog:contact' %}">Contact</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">Careers</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <h5 class="footer-title">Newsletter</h5>
                        <p class="footer-newsletter-text">Subscribe to get special offers and updates.</p>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Enter your email" required>
                            <button type="submit"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="copyright">&copy; 2026 Angaza Creatives. All rights reserved.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <div class="footer-payments">
                            <i class="fab fa-cc-visa"></i>
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-cc-paypal"></i>
                            <i class="fab fa-cc-amex"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-chevron-up"></i>
    </button>
    
    <!-- Mobile Bottom Navigation Bar -->
    <nav class="mobile-bottom-nav d-lg-none">
        <a href="{% url 'catalog:product_list' %}" class="mobile-nav-item">
            <i class="fas fa-th-large"></i>
            <span>Shop</span>
        </a>
        <a href="{% url 'catalog:wishlist' %}" class="mobile-nav-item">
            <i class="far fa-heart"></i>
            <span>Wishlist</span>
        </a>
        <a href="{% url 'catalog:cart' %}" class="mobile-nav-item mobile-cart-btn">
            <div class="mobile-cart-icon">
                <i class="fas fa-shopping-bag"></i>
                <span class="mobile-cart-badge cart-count" id="mobileCartCount">{{ cart_count }}</span>
            </div>
            <span>Cart</span>
        </a>
        {% if user.is_authenticated %}
        <a href="{% url 'accounts:profile' %}" class="mobile-nav-item">
            <i class="fas fa-user-circle"></i>
            <span>Account</span>
        </a>
        {% else %}
        <a href="{% url 'accounts:login' %}" class="mobile-nav-item">
            <i class="fas fa-user"></i>
            <span>Login</span>
        </a>
        {% endif %}
    </nav>
    
    <!-- Currency Modal for Mobile -->
    <div class="modal fade" id="currencyModal" tabindex="-1" aria-labelledby="currencyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="currencyModalLabel">Select Currency</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="currency-list">
                        {% for currency in currencies %}
                        <a class="currency-list-item {% if currency == current_currency %}active{% endif %}" 
                           href="#" data-currency="{{ currency.code }}">
                            <span class="currency-symbol">{{ currency.symbol }}</span>
                            <span class="currency-info">
                                <strong>{{ currency.code }}</strong>
                                <small>{{ currency.name }}</small>
                            </span>
                            {% if currency == current_currency %}
                            <i class="fas fa-check"></i>
                            {% endif %}
                        </a>
                        {% empty %}
                        <a class="currency-list-item active" href="#">
                            <span class="currency-symbol">$</span>
                            <span class="currency-info">
                                <strong>USD</strong>
                                <small>US Dollar</small>
                            </span>
                            <i class="fas fa-check"></i>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Custom JS -->
    <script src="{% static 'js/main.js' %}"></script>
    
    <!-- CSRF Token for AJAX -->
    <script>
        const csrftoken = '{{ csrf_token }}';
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
